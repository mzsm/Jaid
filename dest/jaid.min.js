/*
 <a href="http://www.opensource.org/licenses/mit-license.php">The MIT License</a>
*/
var __extends=this.__extends||function(h,f){function l(){this.constructor=h}for(var k in f)f.hasOwnProperty(k)&&(h[k]=f[k]);l.prototype=f.prototype;h.prototype=new l},Jaid;
(function(h){var f=function(){function d(a,c,b,e){this.version=1;this.objectStores=[];this.migrationHistory={};"string"===typeof a?(this.name=a,this.version=c||this.version,this.objectStores=b||this.objectStores,this.migrationHistory=e||this.migrationHistory):"object"===typeof a&&a&&(this.name=a.name||this.name,this.version=a.version||this.version,this.objectStores=a.objectStores||this.objectStores,this.migrationHistory=a.migrationHistory||this.migrationHistory)}d.prototype.open=function(){if(this.target)throw Error("This database was already opened.");
return new l(this,indexedDB.open(this.name,this.version))};d.prototype.close=function(){if(!this.target)throw Error("This database is not yes opened.");this.target.close();this.target=null};d.prototype.delete=function(){indexedDB.deleteDatabase(this.name)};d.prototype.insert=function(a,c,b){return this.readWriteTransaction(a).add(a,c,b)};d.prototype.save=function(a,c,b){return this.readWriteTransaction(a).put(a,c,b)};d.prototype.readOnlyTransaction=function(a){return new m(this,a)};d.prototype.readWriteTransaction=
function(a){return new n(this,a)};return d}();h.Database=f;var l=function(){function d(a,c){var b=this;this.source=a;this.target=c;try{this.migrationManager=new q(this,this.source.objectStores,this.source.migrationHistory)}catch(e){console.log(e,e.stack)}c.onsuccess=function(a){b.source.target=a.target.result;b.onsuccess(a)};c.onerror=function(a){b.onerror(c.error,a)};c.onblocked=function(a){b.onblocked(a)};c.onupgradeneeded=function(a){var c=a.target;b.source.target=c.result;c=new r(b.source,c.transaction);
b.migrationManager.execute(c,a)}}d.prototype.onSuccess=function(a){this.onsuccess=a;return this};d.prototype.onError=function(a){this.onerror=a;return this};d.prototype.onBlocked=function(a){this.onblocked=a;return this};d.prototype.onCreated=function(a){this.oncreated=a;return this};return d}(),k=function(){function d(a,c){this.executed=this.continued=!1;this.createdObjectStores=[];this.createdIndexes=[];this.droppedObjectStores=[];this.droppedIndexes=[];this.source=a;this.version=c}d.prototype.next=
function(){this.continued?console.error("Already called."):(this.continued=!0,this.source.next())};d.prototype.execute=function(a){var c=this;this.executed?console.error("Already called."):(this.createdObjectStores.forEach(function(b){a.createObjectStore(b,c.version)}),this.createdIndexes.forEach(function(c){a.createIndex(c.storeName,c.index)}),this.droppedObjectStores.forEach(function(c){a.dropObjectStore(c)}),this.createdIndexes.forEach(function(c){a.dropIndex(c.storeName,c.index)}),this.customOperation?
this.customOperation(a,this):this.next())};return d}(),q=function(){function d(a,c,b){var e=this;this.versions={};this.versionNumbers=[];this.source=a;this.objectStores=c;this.objectStores.forEach(function(a){a=d.checkObjectStore(a);if(a.created){var c=e.get(a.created);c.createdObjectStores.push(a)}a.dropped&&(c=e.get(a.dropped),c.droppedObjectStores.push(a));a.indexes.forEach(function(c){c=d.checkIndex(c,a);if(c.created&&(!a.created||c.created>a.created)){var b=e.get(c.created);b.createdIndexes.push({storeName:a.name,
index:c})}c.dropped&&(!a.dropped||c.dropped<a.dropped)&&(b=e.get(c.dropped),b.droppedIndexes.push({storeName:a.name,index:c}))})});Object.keys(b).forEach(function(a){a=parseInt(a);e.get(a).customOperation=b[a]})}d.checkObjectStore=function(a){if(a.created&&a.dropped&&a.created>=a.dropped)throw Error(a.name+': "dropped" is MUST be greater than "created"');a.indexes=a.indexes||[];return a};d.checkIndex=function(a,c){a.name||(Array.isArray(a.keyPath)?a.name=a.keyPath.join("_"):a.name=a.keyPath);if(a.created){if(a.dropped&&
a.created>=a.dropped)throw Error(a.name+': "dropped" is MUST be greater than "created"');if(c.created&&a.created<c.created)throw Error(a.name+': "created" is MUST be greater than or equal to objectStore\'s "created"');if(c.dropped&&a.created>=c.dropped)throw Error(a.name+': "created" is MUST be lesser than objectStore\'s "dropped"');}if(a.dropped){if(c.dropped&&a.dropped>c.dropped)throw Error(a.name+': "dropped" is MUST be lesser than or equal to objectStore\'s "created"');if(c.created&&a.dropped<=
c.created)throw Error(a.name+': "dropped" is MUST be greater than objectStore\'s "created"');}return a};d.prototype.get=function(a){a in this.versions||(this.versions[a]=new k(this,a));return this.versions[a]};d.prototype.initialize=function(a){var c=this;this.objectStores.forEach(function(b){b.created&&b.created>a||b.dropped&&b.dropped<=a||c.transaction.createObjectStore(b,a)})};d.prototype.migration=function(a,c){this.versionNumbers=Object.keys(this.versions).map(function(a){return parseInt(a)});
this.versionNumbers=this.versionNumbers.filter(function(b,e){return b>c&&b<=a&&this.indexOf(b)==e},this.versionNumbers).sort();this.next()};d.prototype.next=function(){var a=this.versionNumbers.shift();a&&this.versions[a].execute(this.transaction)};d.prototype.execute=function(a,c){this.transaction=a;0==c.oldVersion?(this.initialize(c.newVersion),this.source.oncreated(a,c)):this.migration(c.newVersion,c.oldVersion)};return d}(),m=function(d){function a(a,b,e){d.call(this,a,b,e||"readonly")}__extends(a,
d);a.prototype.getByKey=function(a,b){var e=this.target.objectStore(a),e=new g(e.get(b));this._registerRequest(e);return e};a.prototype.getByIndex=function(a,b,e){a=this.target.objectStore(a).index(b);e=new g(a.get(e));this._registerRequest(e);return e};a.prototype.findByKey=function(a,b,e){a=this.target.objectStore(a);b=new p(a.openCursor(b,e));this._registerRequest(b);return b};a.prototype.findByIndex=function(a,b,e,d){a=this.target.objectStore(a).index(b);e=new p(a.openCursor(e,d));this._registerRequest(e);
return e};return a}(function(){function d(a,c,b){var e=this;this.oncomplete=function(a){};this.onerror=function(){};this.onabort=function(){};this.results={};this.requestCounter=0;this.requests=[];this.groupList=[];this.source=a;"object"===typeof c&&c instanceof IDBTransaction?this.target=c:("string"===typeof c&&(c=[c]),this.target=this.source.target.transaction(c,b));this.target.oncomplete=function(){e.oncomplete(e.results)};this.target.onerror=function(){e.onerror()};this.target.onabort=function(){e.onabort()}}
d.prototype._registerRequest=function(a){a.id=this.requestCounter++;a.source=this;this.requests.push(a);return this};d.prototype.onComplete=function(a){this.oncomplete=a;return this};d.prototype.onError=function(a){this.onerror=a;return this};d.prototype.onAbort=function(a){this.onabort=a;return this};d.prototype.abort=function(){this.target.abort()};d.prototype.grouping=function(a){a=new s(this,a);a.id=this.requestCounter++;this.groupList.push(a);return a};d.prototype._requestCallback=function(a,
c){this.groupList.forEach(function(b){a.id in b.queue&&(a.target.error?b.errors[a.id]=c:b.results[a.id]=c,delete b.queue[a.id],b.joined&&b.checkComplete())})};return d}()),n=function(d){function a(a,b,e){d.call(this,a,b,e||"readwrite")}__extends(a,d);a.prototype.add=function(a,b,e){a=this.target.objectStore(a);b=new g(a.add(b,e));this._registerRequest(b);return b};a.prototype.put=function(a,b,e){a=this.target.objectStore(a);b=new g(a.put(b,e));this._registerRequest(b);return b};a.prototype.deleteByKey=
function(a,b){var e=this.target.objectStore(a),e=new g(e.delete(b));this._registerRequest(e);return e};return a}(m),r=function(d){function a(a,b){d.call(this,a,b)}__extends(a,d);a.prototype.createObjectStore=function(a,b){var e=this,d=this.source.target.createObjectStore(a.name,{keyPath:a.keyPath,autoIncrement:a.autoIncrement||!1});"number"===typeof b&&a.indexes.forEach(function(a){a.created&&a.created>b||a.dropped&&a.dropped<=b||e.createIndex(d,a)});return d};a.prototype.createIndex=function(a,b){return("function"===
typeof a&&a instanceof IDBObjectStore?a:this.target.objectStore("string"===typeof a?a:a.name)).createIndex(b.name,b.keyPath,{unique:b.unique||!1,multiEntry:b.multiEntry||!1})};a.prototype.dropObjectStore=function(a){this.source.target.deleteObjectStore("string"===typeof a?a:a.name)};a.prototype.dropIndex=function(a,b){("function"===typeof a&&a instanceof IDBObjectStore?a:this.target.objectStore("string"===typeof a?a:a.name)).deleteIndex("string"===typeof b?b:b.name)};a.prototype.onComplete=function(a){console.error("Cannot change oncomplete event in VersionChangeTransaction.");
return this};a.prototype.onError=function(a){console.error("Cannot change onerror event in VersionChangeTransaction.");return this};a.prototype.onAbort=function(a){console.error("Cannot change onabort event in VersionChangeTransaction.");return this};a.prototype.abort=function(){console.error("Cannot call abort method in VersionChangeTransaction.")};return a}(n),g=function(){function d(a){var c=this;this.target=a;this.onSuccess(function(a,e){c.source.results[c.id]=e.target});this.onError(function(a,
e){console.log(c)})}d.prototype.onSuccess=function(a){var c=this;this.target.onsuccess=function(b){var e=b.target.result;c.source._requestCallback(c,e);a(e,b)};return this};d.prototype.onError=function(a){var c=this;this.target.onerror=function(b){var e=b.target.error;c.source._requestCallback(c,e);a(e,b)};return this};return d}(),p=function(d){function a(a){var b=this;d.call(this,a);this.continueFlag=!0;this.values=[];this.onSuccess(function(a,c){b.values.push({key:a.key,primaryKey:a.primaryKey,
value:a.value})})}__extends(a,d);a.prototype.stopCursor=function(){this.continueFlag=!1};a.prototype._onstopiteration=function(){this.source._requestCallback(this,this.values);if(this.onstopiteration)this.onstopiteration(this.values)};a.prototype.onStopIteration=function(a){var b=this;this.onstopiteration=function(d){a(d);b.source.results[b.id]=event.target};return this};a.prototype.onSuccess=function(a){var b=this;this.target.onsuccess=function(d){var f=d.target.result;f?(a(f,d),b.continueFlag?f.continue():
b._onstopiteration()):b._onstopiteration()};return this};return a}(g),s=function(){function d(a,c){var b=this;this.target={error:!1};this.joined=!1;this.requests=[];this.queue={};this.results={};this.errors={};this.onsuccess=function(){};this.oncomplete=function(a,b){};this.source=a;c&&(this.requests=c,this.requests.forEach(function(a){b.queue[a.id]=a}))}d.prototype._oncomplete=function(){this.source._requestCallback(this,this.results);this.oncomplete(this.results,this.errors)};d.prototype.add=function(a){this.requests.push(a);
this.queue[a.id]=a};d.prototype.remove=function(a){var c=this.requests.indexOf(a);-1!=c&&delete this.requests[c];a.id in this.queue&&delete this.queue[a.id]};d.prototype.checkComplete=function(){0==Object.keys(this.queue).length&&this._oncomplete()};d.prototype.joinAll=function(){this.joined=!0;this.checkComplete()};d.prototype.onSuccess=function(a){this.onsuccess=a;return this};d.prototype.onComplete=function(a){this.oncomplete=a;return this};return d}()})(Jaid||(Jaid={}));
